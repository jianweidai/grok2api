version: '3.8'

services:
  grok2api:
    container_name: grok2api
    image: ${DOCKER_IMAGE:-ghcr.io/chenyme/grok2api:latest}
    # 如果使用你自己构建的镜像，修改为：
    # image: ${DOCKERHUB_USERNAME}/grok2api:latest
    restart: unless-stopped
    ports:
      - "${SERVER_PORT:-8999}:8999"
    environment:
      # 时区
      TZ: Asia/Shanghai
      
      # 日志级别
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      
      # 服务配置
      SERVER_HOST: 0.0.0.0
      SERVER_PORT: 8999
      SERVER_WORKERS: ${SERVER_WORKERS:-1}
      
      # 存储配置 - 连接到外部 MySQL
      SERVER_STORAGE_TYPE: mysql
      SERVER_STORAGE_URL: ${MYSQL_URL}
      
      # MySQL URL 格式：
      # mysql+aiomysql://用户名:密码@主机:端口/数据库名
      # 示例：mysql+aiomysql://grok2api:password@192.168.1.100:3306/grok2api
    
    volumes:
      # 配置文件
      - ./data/config.toml:/app/data/config.toml
      # 日志目录
      - ./logs:/app/logs
      # 缓存目录
      - ./cache:/app/cache
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8999/v1/models"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  default:
    name: grok2api-network
